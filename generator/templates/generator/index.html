{% load static %}

<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <meta name="csrf-token" content="{{ csrf_token }}">

  <title>AI Prompt Generator for Educators</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://unpkg.com/daisyui@4.4.2/dist/full.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="{% static 'generator/onboarding.css' %}">

  <script>

    tailwind.config = {

      daisyui: {

        themes: ["dark"]

      }

    }

  </script>

</head>

<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

  

  <div class="max-w-4xl mx-auto px-4 py-8">

    <div class="bg-white rounded-2xl shadow-xl p-8">

      <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white py-8 mb-8 rounded-xl shadow-lg">

  <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl shadow-lg px-6 py-10 sm:px-12 sm:py-12 max-w-5xl mx-auto">

  <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6 mb-6">
    <img src="{% static 'generator/eduPromptStudio_logo.png' %}" 
        alt="EduPrompt Studio Logo"
        class="h-16 w-16 object-contain rounded-md shadow-md bg-white p-1" />
    <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight leading-tight text-center sm:text-left">
        EduPrompt Studio
    </h1>
    </div>



  <p class="text-lg sm:text-xl font-medium text-center mb-2">

    Design better prompts with AI – in seconds

  </p>

  <p class="text-sm sm:text-base text-center opacity-90">

    Craft research-based, classroom-ready prompts effortlessly

  </p>

</div>



</div>

<div class="mb-6 text-center">
  <a href="/help/" class="btn btn-outline btn-info">
    📚 User Guide & Help
  </a>
  <p class="text-sm text-gray-500 mt-2">
    New to EduPrompt Studio? Check out our comprehensive guide!
  </p>
</div>

      <form id="promptForm" onsubmit="handleSubmit(event)">

        

        <div class="mb-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200">
  <label for="template" class="block text-lg font-semibold mb-3 text-purple-800">
    ⚡ Γρήγορη Εκκίνηση - Επιλέξτε πρότυπο (προαιρετικό)
  </label>
  <select id="template" name="template" class="select select-bordered w-full max-w-md bg-white">
    <option value="">Δημιουργία από την αρχή</option>
    <optgroup label="📚 Σχεδιασμός Μαθήματος">
      <option value="lesson_plan">Πλήρες Σχέδιο Μαθήματος</option>
      <option value="warm_up">Δραστηριότητες Προθέρμανσης</option>
      <option value="lesson_intro">Εισαγωγή σε Νέο Θέμα</option>
    </optgroup>
    <optgroup label="🤔 Κριτική Σκέψη">
      <option value="critical_questions">Ερωτήσεις Κριτικής Σκέψης</option>
      <option value="problem_solving">Δραστηριότητες Επίλυσης Προβλημάτων</option>
      <option value="debates">Συζητήσεις & Διαλογικές Συζητήσεις</option>
    </optgroup>
    <optgroup label="📝 Εξάσκηση & Δραστηριότητες">
      <option value="practice_exercises">Ασκήσεις Εξάσκησης</option>
      <option value="worksheet">Δημιουργία Φύλλου Εργασίας</option>
      <option value="group_activities">Ομαδικές Δραστηριότητες</option>
      <option value="creative_writing">Δημιουργική Γραφή</option>
    </optgroup>
    <optgroup label="🎯 Αξιολόγηση">
      <option value="quiz_assessment">Κουίζ & Αξιολόγηση</option>
      <option value="rubrics">Δημιουργία Κριτηρίων Αξιολόγησης (Rubrics)</option>
      <option value="feedback">Παροχή Ανατροφοδότησης</option>
    </optgroup>
    <optgroup label="🌟 Διαφοροποίηση">
      <option value="differentiated">Διαφοροποιημένες Δραστηριότητες</option>
      <option value="special_needs">Ειδικές Εκπαιδευτικές Ανάγκες</option>
      <option value="revision">Δραστηριότητες Επανάληψης</option>
    </optgroup>
  </select>
  <p class="text-sm text-purple-600 mt-2">💡 Επιλέξτε πρότυπο για αυτόματη συμπλήρωση των πεδίων</p>
</div>

<!-- ROLE -->
<div class="mb-6">
  <label for="role" class="block text-lg font-semibold mb-3 text-gray-700">
    🤖 Ποιος είναι ο διδακτικός σας ρόλος;
  </label>
  <div class="flex flex-col sm:flex-row gap-3">
    <select id="role" name="role" class="select select-bordered flex-1">
  <option value="">Επιλέξτε ρόλο</option>
  <optgroup label="Εκπαιδευτικές Βαθμίδες">
    <option>Νηπιαγωγός</option>
    <option>Δάσκαλος/Δασκάλα Δημοτικού</option>
    <option>Καθηγητής/τρια Γυμνασίου</option>
    <option>Καθηγητής/τρια Λυκείου</option>
    <option>Ειδικός Παιδαγωγός</option>
    <option>Καθηγητής/τρια Ξένων Γλωσσών</option>
  </optgroup>
  <optgroup label="Ειδικότητες Μαθημάτων">
    <option>Καθηγητής/τρια Μαθηματικών</option>
    <option>Καθηγητής/τρια Φυσικών Επιστημών</option>
    <option>Καθηγητής/τρια Ιστορίας</option>
    <option>Φιλόλογος</option>
    <option>Καθηγητής/τρια Καλλιτεχνικών</option>
    <option>Καθηγητής/τρια Φυσικής Αγωγής</option>
  </optgroup>
  <optgroup label="Άλλοι Ρόλοι">
    <option>Φροντιστής/Ιδιαιτέρων Μαθημάτων</option>
    <option>Γονέας που εξηγεί στο παιδί</option>
    <option>Εκπαιδευτικός Σύμβουλος</option>
    <option>Άλλο</option>
  </optgroup>
</select>
    <input id="roleOther" name="roleOther" type="text"
      placeholder="Παρακαλώ διευκρινίστε..."
      class="input input-bordered flex-1 hidden" />
  </div>
</div>

<!-- SUBJECT/TOPIC -->
<div class="mb-6">
  <label for="subject" class="block text-lg font-semibold mb-3 text-gray-700">
    📖 Ποιο είναι το περιεχόμενο και οι μαθησιακοί στόχοι;
  </label>
  <input id="subject" name="subject" type="text"
    placeholder="π.χ., Κλάσματα - κατανόηση ισοδυναμίας και πράξεων, Β' Παγκόσμιος Πόλεμος - ανάλυση αιτιών και συνεπειών"
    class="input input-bordered w-full"
    required />
    <p class="text-sm text-gray-500 mt-1">Συμπεριλάβετε τόσο τη θεματική περιοχή όσο και τους συγκεκριμένους μαθησιακούς στόχους</p>
</div>

<!-- TASK -->
<div class="mb-6">
  <label for="task" class="block text-lg font-semibold mb-3 text-gray-700">
    🎯 Τι μαθησιακή εμπειρία θέλετε να δημιουργήσετε;
  </label>
  <div class="flex flex-col sm:flex-row gap-3">
    <select id="task" name="task" class="select select-bordered flex-1">
  <option value="">Επιλέξτε δραστηριότητα</option>
  <optgroup label="Δημιουργία Περιεχομένου με Τεχνολογία">
    <option>Δημιουργία πλήρους σχεδίου μαθήματος με στόχους</option>
    <option>Δημιουργία ασκήσεων εξάσκησης με απαντήσεις</option>
    <option>Δημιουργία ολοκληρωμένου φύλλου εργασίας</option>
    <option>Σχεδιασμός κουίζ ή αξιολόγησης</option>
    <option>Δημιουργία ρουμπρίκας αξιολόγησης</option>
    <option>Δημιουργία δραστηριοτήτων λεξιλογίου</option>
    <option>Παροχή ανατροφοδότησης σε εργασία μαθητή</option>
  </optgroup>
  <optgroup label="Παιδαγωγική με Τεχνολογία">
    <option>Σχεδιασμός δραστηριότητας προθέρμανσης</option>
    <option>Δημιουργία εισαγωγής σε νέο θέμα</option>
    <option>Δημιουργία παιχνιδοποιημένων δραστηριοτήτων</option>
    <option>Σχεδιασμός πρακτικών πειραμάτων</option>
    <option>Δημιουργία δραστηριοτήτων αφήγησης</option>
    <option>Σχεδιασμός εφαρμογών στην πραγματική ζωή</option>
  </optgroup>
  <optgroup label="Ολοκληρωμένος Σχεδιασμός Μάθησης">
    <option>Δημιουργία ερωτήσεων κριτικής σκέψης</option>
    <option>Σχεδιασμός σεναρίων επίλυσης προβλημάτων</option>
    <option>Δημιουργία θεμάτων και επιχειρημάτων συζήτησης</option>
    <option>Δημιουργία μελετών περίπτωσης για ανάλυση</option>
    <option>Σχεδιασμός διαφοροποιημένων δραστηριοτήτων</option>
    <option>Δημιουργία δραστηριοτήτων για πολλαπλές νοημοσύνες</option>
    <option>Προσαρμογή περιεχομένου για ειδικές ανάγκες</option>
    <option>Δημιουργία δραστηριοτήτων επέκτασης</option>
    <option>Δημιουργία δραστηριοτήτων επανάληψης</option>
    <option>Δημιουργία προτροπών δημιουργικής γραφής</option>
  </optgroup>
  <optgroup label="Άλλο">
    <option>Άλλο</option>
  </optgroup>
</select>
    <input id="taskOther" name="taskOther" type="text"
      placeholder="Παρακαλώ διευκρινίστε..."
      class="input input-bordered flex-1 hidden" />
  </div>
</div>

<!-- CONTEXT -->
<div class="mb-6">
  <label for="context" class="block text-lg font-semibold mb-3 text-gray-700">
    🎓 Για ποιους απευθύνεται; Ποιο είναι το πλαίσιο;
  </label>
  <div class="flex flex-col sm:flex-row gap-3">
    <select id="context" name="context" class="select select-bordered flex-1" required>
  <option value="">Επιλέξτε πλαίσιο</option>
  <optgroup label="Ηλικιακές Ομάδες">
    <option>Προνηπιακή/Νηπιαγωγείο (3-5 ετών)</option>
    <option>Δημοτικό (6-11 ετών)</option>
    <option>Γυμνάσιο (12-14 ετών)</option>
    <option>Λύκειο (15-18 ετών)</option>
    <option>Ενήλικες μαθητές</option>
  </optgroup>
  <optgroup label="Μαθησιακά Περιβάλλοντα">
    <option>Παραδοσιακή τάξη</option>
    <option>Εξ αποστάσεως/Online μάθηση</option>
    <option>Υβριδική τάξη</option>
    <option>Οικογενειακή εκπαίδευση</option>
    <option>Απογευματινό πρόγραμμα</option>
  </optgroup>
  <optgroup label="Ειδικές Περιπτώσεις">
    <option>Τάξη μικτών ικανοτήτων</option>
    <option>Μαθητές ξένης γλώσσας</option>
    <option>Μαθητές με μαθησιακές δυσκολίες</option>
    <option>Προικισμένοι μαθητές</option>
    <option>Μαθητές σε προετοιμασία για εξετάσεις</option>
  </optgroup>
  <optgroup label="Άλλο">
    <option>Άλλο</option>
  </optgroup>
</select>
    <input id="contextOther" name="contextOther" type="text"
      placeholder="Παρακαλώ διευκρινίστε..."
      class="input input-bordered flex-1 hidden" />
  </div>
</div>

<!-- METHODOLOGY -->
<div class="mb-6">
  <label for="methodology" class="block text-lg font-semibold mb-3 text-gray-700">
    🎯 Μέθοδος Διδασκαλίας
    <span class="text-sm text-gray-500 font-normal ml-2">(Πώς θα οργανώσεις τη δραστηριότητα)</span>
  </label>
  
  <div class="flex flex-col sm:flex-row gap-3">
    <select id="methodology" name="methodology" class="select select-bordered flex-1">
      <option value="">Επιλέξτε μεθοδολογία</option>
      
      <optgroup label="Παραδοσιακές Παιδαγωγικές Μέθοδοι">
        <option>Άμεση Διδασκαλία</option>
        <option>Διερευνητική Μάθηση</option>
        <option>Μάθηση Βασισμένη σε Προβλήματα</option>
        <option>Συνεργατική Μάθηση</option>
        <option>Μάθηση Βασισμένη σε Έργα</option>
        <option>Διαφοροποιημένη Διδασκαλία</option>
        <option>Προσεγγίσεις Επικεντρωμένες στην Αξιολόγηση</option>
      </optgroup>
      
      <optgroup label="Μέθοδοι με Ενσωμάτωση Τεχνολογίας">
        <option>Άμεση Διδασκαλία με Υποστήριξη Τεχνολογίας</option>
        <option>Ψηφιακή Διερευνητική Μάθηση</option>
        <option>Επίλυση Προβλημάτων με Ενσωμάτωση Τεχνολογίας</option>
        <option>Ψηφιακή Συνεργατική Μάθηση</option>
        <option>Εργασία σε Έργα με Ενσωμάτωση Τεχνολογίας</option>
        <option>Προσαρμοστική Μάθηση με Ψηφιακά Εργαλεία</option>
        <option>Αξιολόγηση με Ενσωμάτωση Τεχνολογίας</option>
      </optgroup>
      
      <optgroup label="Άλλο">
        <option>Άλλο</option>
      </optgroup>
    </select>
    
    <input id="methodologyOther" name="methodologyOther" type="text"
      placeholder="Παρακαλώ διευκρινίστε..."
      class="input input-bordered flex-1 hidden" />
  </div>
  
  <!-- NEW: Methodology explanation box - ΕΞΩ από το flex container -->
  <div id="methodology_info" class="hidden mt-2 p-3 bg-blue-50 border-l-4 border-blue-500 rounded">
    <p id="methodology_description" class="text-sm text-gray-700 mb-1"></p>
    <p id="methodology_when" class="text-xs text-blue-600 italic"></p>
  </div>
  
  <!-- Πρόταση Βασισμένη σε Έρευνα -->
  <div id="methodology_suggestion" class="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200 hidden">
    <div class="flex items-start space-x-2">
      <div class="text-blue-600 mt-0.5 flex-shrink-0">💡</div>
      <div class="min-w-0 flex-1">
        <div class="text-sm font-medium text-blue-800 mb-1">Πρόταση Βασισμένη σε Έρευνα:</div>
        <div id="suggestion_content" class="text-sm text-blue-700 leading-relaxed mb-2"></div>
        
        <!-- Εναλλακτικές Επιλογές -->
        <div class="mt-3 pt-2 border-t border-blue-200">
          <div class="text-xs font-medium text-blue-800 mb-2">Εναλλακτικές προσεγγίσεις που μπορείτε να εξετάσετε:</div>
          <div id="alternative_options" class="flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TONE -->
<div class="mb-6">
  <label for="tone" class="block text-lg font-semibold mb-3 text-gray-700">
    🎭 Ποιος τόνος πρέπει να υιοθετήσει η ΤΝ;
  </label>
  <div class="flex flex-col sm:flex-row gap-3">
    <select id="tone" name="tone" class="select select-bordered flex-1">
  <option value="">Επιλέξτε τόνο</option>
  <optgroup label="Υποστηρικτικός">
    <option>Ενθαρρυντικός και υποστηρικτικός</option>
    <option>Υπομονετικός και απαλός</option>
    <option>Παρακινητικός και εμπνευστικός</option>
    <option>Φροντιστικός και στοργικός</option>
  </optgroup>
  <optgroup label="Ελκυστικός">
    <option>Φιλικός και συζητήσιμος</option>
    <option>Χιουμοριστικός και παιχνιδιάρικος</option>
    <option>Ενθουσιώδης και ενεργητικός</option>
    <option>Περίεργος και εξερευνητικός</option>
  </optgroup>
  <optgroup label="Επαγγελματικός">
    <option>Ακαδημαϊκός και ακριβής</option>
    <option>Ουδέτερος και αντικειμενικός</option>
    <option>Επίσημος και δομημένος</option>
    <option>Σαφής και άμεσος</option>
  </optgroup>
  <optgroup label="Χαλαρός">
    <option>Ανεπίσημος και χαλαρός</option>
    <option>Χαλαρός και προσιτός</option>
    <option>Άλλο</option>
  </optgroup>
</select>
    <input id="toneOther" name="toneOther" type="text"
      placeholder="Παρακαλώ διευκρινίστε..."
      class="input input-bordered flex-1 hidden" />
  </div>
</div>

<!-- EXAMPLES / EXCLUSIONS -->
<div class="mb-8">
  <label for="examples" class="block text-lg font-semibold mb-3 text-gray-700">
    📋 Επιπλέον Οδηγίες (Προαιρετικό)
  </label>
  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium mb-2 text-green-700">✅ Να περιλαμβάνει:</label>
      <textarea id="include" name="include"
        placeholder="π.χ., Παραδείγματα από την καθημερινή ζωή, οπτικά μέσα, βήμα-βήμα οδηγίες"
        class="textarea textarea-bordered w-full h-24 border-green-300 focus:border-green-500"></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2 text-red-700">❌ Να αποφεύγει:</label>
      <textarea id="exclude" name="exclude"
        placeholder="π.χ., Πολύπλοκη ορολογία, αφηρημένες έννοιες, μακροσκελείς εξηγήσεις"
        class="textarea textarea-bordered w-full h-24 border-red-300 focus:border-red-500"></textarea>
    </div>
  </div>
  <p class="text-sm text-gray-500 mt-2">💡 Αυτά τα πεδία είναι προαιρετικά αλλά βοηθούν στη δημιουργία πιο στοχευμένων prompts</p>
</div>

<!-- ENHANCEMENT OPTIONS -->
<div class="mb-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
  <h4 class="font-semibold text-yellow-800 mb-3">🎓 Επιλογές Βελτίωσης Prompt:</h4>
  <div class="space-y-3">
    <label class="flex items-center">
      <input type="radio" name="enhancement" value="enhanced" class="mr-2">
      <span class="text-sm">
        <strong>Δημιουργία με βελτιώσεις θεωρίας μάθησης</strong> (συνιστάται)
        <br><em class="text-gray-600">Περιλαμβάνει εκπαιδευτικά πλαίσια για βελτίωση της παιδαγωγικής αποτελεσματικότητας</em>
      </span>
    </label>
    
    <!-- Επιλογή Θεωρίας - Εμφανίζεται όταν επιλεγεί το Enhanced -->
    <div id="theory_selection_section" class="ml-6 mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
      <label class="block text-sm font-medium text-blue-800 mb-2">Επιλέξτε Εκπαιδευτική Θεωρία:</label>
      
      <div class="space-y-3">
        <!-- Αναπτυσσόμενο Μενού Θεωριών -->
        <select id="theory_enhancement" name="theory_enhancement" class="select select-bordered w-full bg-white text-sm">
          <option value="">Αυτόματη επιλογή καλύτερης θεωρίας για αυτή τη δραστηριότητα</option>
          <option value="blooms">Ταξινομία Bloom (Bloom's Taxonomy) - Γνωστική Εξέλιξη</option>
          <option value="udl">Αρχές UDL (Universal Design for Learning) - Συμπεριληπτικός Σχεδιασμός</option>
          <option value="tpack">Πλαίσιο TPACK - Ενσωμάτωση Τεχνολογίας</option>
          <option value="constructivist">Εποικοδομιστική Μάθηση (Constructivist Learning) - Ενεργή Ανακάλυψη</option>
          <option value="social_learning">Θεωρία Κοινωνικής Μάθησης (Social Learning Theory) - Συνεργασία με Συνομηλίκους</option>
          <option value="scaffolding">Σκαλωσιά (Scaffolding) - Σταδιακή Υποστήριξη</option>
          <!--<option value="differentiation">Διαφοροποιημένη Διδασκαλία (Differentiated Instruction) - Εξατομικευμένες Διαδρομές</option>-->
        </select>
        
        <!-- Έξυπνη Εμφάνιση Σύστασης -->
        <div id="theory_recommendation" class="bg-green-50 p-3 rounded-lg border border-green-300 hidden">
          <div class="flex items-start space-x-2">
            <div class="text-green-600 mt-0.5 flex-shrink-0">💡</div>
            <div class="min-w-0 flex-1">
              <div class="text-sm font-medium text-green-800 mb-1">Σύσταση Συστήματος:</div>
              <div id="recommendation_text" class="text-sm text-green-700 leading-relaxed"></div>
            </div>
          </div>
        </div>
        
        <!-- Εμφάνιση Πληροφοριών Θεωρίας -->
        <div id="theory_info" class="bg-gray-50 p-3 rounded-lg border border-gray-200 hidden">
          <div class="text-sm">
            <div class="font-medium text-gray-800 mb-1" id="theory_title"></div>
            <div class="text-gray-600 leading-relaxed" id="theory_description"></div>
          </div>
        </div>
      </div>
    </div>
    
    <label class="flex items-center">
      <input type="radio" name="enhancement" value="basic" class="mr-2" checked>
      <span class="text-sm">
        <strong>Δημιουργία ακριβώς όπως καθορίστηκε (Basic Mode)</strong>
        <br><em class="text-gray-600">Χωρίς πρόσθετες θεωρητικές βελτιώσεις</em>
      </span>
    </label>
  </div>
</div>

<!-- SUBMIT BUTTON -->
<div class="text-center">
  <button type="button" id="generateBtn" onclick="generateWithGemini()" 
          class="btn btn-primary text-white px-8 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-lg font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
    🚀 Δημιουργία Prompt
  </button>
</div>

        

        <!-- LOADING INDICATOR -->

        <div id="loadingIndicator" class="text-center mt-8 hidden">

          <div class="flex flex-col items-center justify-center">

            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>

            <p class="text-gray-600 font-medium">Generating your prompt… Please wait.</p>

            <p class="text-sm text-gray-500 mt-1">This may take up to 15 seconds</p>

          </div>

        </div>

        

        <!-- PROMPT OUTPUT -->

        <div id="promptContainer" class="mt-8 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg shadow-md border border-green-200" style="display: none;">

          <h2 class="text-xl font-semibold mb-4 text-green-800">✨ Your Generated Prompt:</h2>

          <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">

            <textarea id="outputPrompt" class="w-full h-48 p-3 text-gray-800 font-mono text-sm border border-gray-300 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>

          </div>

          <div class="mt-4 flex items-center justify-center gap-4">

            <button type="button" onclick="copyToClipboard()" class="btn btn-sm btn-outline btn-success">

              📋 Copy to Clipboard

            </button>

            <button type="button" onclick="showPromptImprovements()" class="btn btn-sm btn-outline btn-info">

              ⚡ Improve This Prompt

            </button>

          </div>

        </div>



      </form>

    </div>

  </div>



  <!-- Prompt Improvements Modal -->

  <div id="promptImprovementsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">

    <div class="bg-white rounded-lg p-6 max-w-2xl mx-4 shadow-2xl transform transition-all duration-300 scale-95 max-h-[90vh] overflow-y-auto">

      <div class="flex justify-between items-center mb-4">

        <h3 class="text-xl font-semibold text-gray-800">⚡ How to Improve This Prompt</h3>

        <button onclick="closePromptImprovementsModal()" class="text-gray-500 hover:text-gray-700">

          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">

            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>

          </svg>

        </button>

      </div>

      

      <div id="theoryLoadingIndicator" class="text-center py-8">

        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>

        <p class="text-gray-600">Analyzing prompt improvements...</p>

      </div>

      

      <div id="theoryContent" class="hidden">

                

        <div class="bg-green-50 p-4 rounded-lg border border-green-200 mb-4">

          <h4 class="font-semibold text-green-800 mb-2">🎯 Your Prompt Configuration:</h4>

          <div id="promptConfiguration" class="text-sm text-gray-600"></div>

        </div>

        

        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">

          <h4 class="font-semibold text-blue-800 mb-2">⚡ Choose Improvements to Apply:</h4>

          <div id="improvementsList" class="space-y-3">

            <!-- Checkboxes will be dynamically added here -->

          </div>

          <div class="mt-4 text-center">

            <button type="button" onclick="applySelectedImprovements()" class="btn btn-sm btn-primary">

              🚀 Apply Selected Improvements

            </button>

          </div>

        </div>

      </div>

      

      <div class="mt-6 text-center">

        <button onclick="closePromptImprovementsModal()" class="btn btn-sm btn-primary">

          Got it!

        </button>

      </div>

    </div>

  </div>



  <!-- Confirmation Modal -->

  <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">

    <div class="bg-white rounded-lg p-6 max-w-sm mx-4 shadow-2xl transform transition-all duration-300 scale-95">

      <div class="text-center">

        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">

          <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">

            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>

          </svg>

        </div>

        <h3 class="text-lg font-semibold text-gray-800 mb-2">Prompt Copied!</h3>

        <p class="text-gray-600 mb-4">Your AI prompt has been successfully copied to the clipboard.</p>

        <button onclick="closeConfirmationModal()" class="btn btn-sm btn-primary">

          Got it!

        </button>

      </div>

    </div>

  </div>



  <script>

    // Template definitions

    // Template definitions
const templates = {
  lesson_plan: {
    role: "Καθηγητής/τρια Λυκείου",
    task: "Δημιουργία πλήρους σχεδίου μαθήματος με στόχους",
    context: "Λύκειο (15-18 ετών)",
    methodology: "Άμεση Διδασκαλία",
    tone: "Ακαδημαϊκός και ακριβής",
    include: "Μαθησιακοί στόχοι, μέθοδοι αξιολόγησης, στρατηγικές διαφοροποίησης, χρονοδιάγραμμα για κάθε δραστηριότητα",
    exclude: "Υπερβολικά σύνθετες δραστηριότητες, μη ρεαλιστικές χρονικές προσδοκίες"
  },

  warm_up: {
    role: "Δάσκαλος/Δασκάλα Δημοτικού",
    task: "Σχεδιασμός δραστηριότητας προθέρμανσης",
    context: "Δημοτικό (6-11 ετών)",
    methodology: "Συνεργατική Μάθηση",
    tone: "Ενθουσιώδης και ενεργητικός",
    include: "Διαδραστικά στοιχεία, διάρκεια 5-10 λεπτών, σύνδεση με προηγούμενη μάθηση",
    exclude: "Μακροσκελείς εξηγήσεις, καθιστικές δραστηριότητες"
  },

  lesson_intro: {
    role: "Καθηγητής/τρια Γυμνασίου",
    task: "Δημιουργία εισαγωγής σε νέο θέμα",
    context: "Γυμνάσιο (12-14 ετών)",
    methodology: "Διερευνητική Μάθηση",
    tone: "Περίεργος και διερευνητικός",
    include: "Δραστηριότητα έλξης ενδιαφέροντος, ενεργοποίηση προηγούμενης γνώσης, προεπισκόπηση μαθησιακών στόχων",
    exclude: "Υπερφόρτωση πληροφοριών, μακροσκελείς εξηγήσεις στην αρχή"
  },

  critical_questions: {
    role: "Καθηγητής/τρια Γυμνασίου",
    task: "Δημιουργία ερωτήσεων κριτικής σκέψης",
    context: "Γυμνάσιο (12-14 ετών)",
    methodology: "Διερευνητική Μάθηση",
    tone: "Περίεργος και διερευνητικός",
    include: "Ερωτήσεις από διαφορετικά γνωστικά επίπεδα, ανοιχτές ερωτήσεις",
    exclude: "Ερωτήσεις ναι/όχι, μόνο πραγματική ανάκληση"
  },

  problem_solving: {
    role: "Καθηγητής/τρια Λυκείου",
    task: "Σχεδιασμός σεναρίων επίλυσης προβλημάτων",
    context: "Λύκειο (15-18 ετών)",
    methodology: "Μάθηση Βασισμένη σε Προβλήματα",
    tone: "Ενθαρρυντικός και υποστηρικτικός",
    include: "Σενάρια πραγματικού κόσμου, διαδικασία σκέψης βήμα-προς-βήμα, συνεργατικά στοιχεία",
    exclude: "Αφηρημένα προβλήματα χωρίς πλαίσιο, συντριπτική πολυπλοκότητα"
  },

  debates: {
    role: "Καθηγητής/τρια Λυκείου",
    task: "Δημιουργία θεμάτων και επιχειρημάτων συζήτησης",
    context: "Λύκειο (15-18 ετών)",
    methodology: "Συνεργατική Μάθηση",
    tone: "Ουδέτερος και αντικειμενικός",
    include: "Ισορροπημένες προοπτικές, επιχειρήματα βασισμένα σε αποδεικτικά στοιχεία, δομημένη μορφή",
    exclude: "Αμφιλεγόμενα προσωπικά θέματα, μονόπλευρα επιχειρήματα"
  },

  practice_exercises: {
    role: "Καθηγητής/τρια Μαθηματικών",
    task: "Δημιουργία ασκήσεων εξάσκησης με απαντήσεις",
    context: "Τάξη μικτού επιπέδου",
    methodology: "Διαφοροποιημένη Διδασκαλία",
    tone: "Ενθαρρυντικός και υποστηρικτικός",
    include: "Διαφορετικά επίπεδα δυσκολίας, λύσεις βήμα-προς-βήμα, εφαρμογές πραγματικού κόσμου",
    exclude: "Επαναλαμβανόμενες ασκήσεις εξάσκησης, μόνο αφηρημένα παραδείγματα"
  },

  worksheet: {
    role: "Δάσκαλος/Δασκάλα Δημοτικού",
    task: "Δημιουργία ολοκληρωμένου φύλλου εργασίας",
    context: "Δημοτικό (6-11 ετών) με ποικίλες μαθησιακές ανάγκες",
    methodology: "Διαφοροποιημένη Διδασκαλία",
    tone: "Ελκυστικός και κατάλληλος για την ηλικία",
    include: "Πολλαπλοί τύποι δραστηριοτήτων (αντιστοίχιση, συμπλήρωση κενών, επισημείωση διαγραμμάτων, λεξικά παζλ), οπτικά στοιχεία, σαφείς οδηγίες, διαφορετικά επίπεδα δυσκολίας, χώρος για δημιουργική εργασία",
    exclude: "Πάρα πολλές δραστηριότητες σε μία σελίδα, κείμενο χωρίς οπτικά στοιχεία, μόνο ένας τύπος δραστηριότητας"
  },

  group_activities: {
    role: "Καθηγητής/τρια Λυκείου",
    task: "Σχεδιασμός ομαδικών δραστηριοτήτων",
    context: "Λύκειο (15-18 ετών)",
    methodology: "Συνεργατική Μάθηση",
    tone: "Φιλικός και συνομιλητικός",
    include: "Σαφείς ρόλοι για κάθε μέλος, συγκεκριμένοι στόχοι, διαχείριση χρόνου",
    exclude: "Ασαφείς οδηγίες, άνισες ευκαιρίες συμμετοχής"
  },

  creative_writing: {
    role: "Φιλόλογος",
    task: "Δημιουργία προτροπών δημιουργικής γραφής",
    context: "Γυμνάσιο (12-14 ετών)",
    methodology: "Μάθηση Βασισμένη σε Έργα",
    tone: "Παρακινητικός και εμπνευστικός",
    include: "Ποικίλα θέματα, αισθητηριακές λεπτομέρειες, προτροπές ανάπτυξης χαρακτήρων",
    exclude: "Υπερβολικά σύνθετα θέματα, θέματα ενηλίκων"
  },

  quiz_assessment: {
    role: "Καθηγητής/τρια Φυσικής/Χημείας/Βιολογίας",
    task: "Σχεδιασμός κουίζ ή αξιολόγησης",
    context: "Λύκειο (15-18 ετών)",
    methodology: "Εστιασμένη στην Αξιολόγηση",
    tone: "Σαφής και άμεσος",
    include: "Πολλαπλοί τύποι ερωτήσεων, σαφή κριτήρια αξιολόγησης, άμεση ανατροφοδότηση",
    exclude: "Ερωτήσεις-παγίδες, ασαφής διατύπωση"
  },

  rubrics: {
    role: "Δάσκαλος/Δασκάλα Δημοτικού",
    task: "Δημιουργία κριτηρίων αξιολόγησης project",
    context: "Δημοτικό (6-11 ετών)",
    methodology: "Μάθηση Βασισμένη σε Έργα",
    tone: "Σαφής και άμεσος",
    include: "Κριτήρια κατάλληλα για την ηλικία, οπτικά στοιχεία, γλώσσα φιλική προς τον μαθητή",
    exclude: "Σύνθετη ορολογία, πάρα πολλά κριτήρια"
  },

  feedback: {
    role: "Δάσκαλος/Δασκάλα Δημοτικού",
    task: "Παροχή ανατροφοδότησης σε εργασία μαθητή",
    context: "Δημοτικό (6-11 ετών)",
    methodology: "Εστιασμένη στην Αξιολόγηση",
    tone: "Ενθαρρυντικός και υποστηρικτικός",
    include: "Συγκεκριμένα παραδείγματα, γλώσσα εστιασμένη στην ανάπτυξη, ενεργά επόμενα βήματα",
    exclude: "Σκληρή κριτική, ασαφή σχόλια, σύγκριση με άλλους μαθητές"
  },

  differentiated: {
    role: "Ειδικός Παιδαγωγός",
    task: "Σχεδιασμός διαφοροποιημένων δραστηριοτήτων",
    context: "Μαθητές με μαθησιακές δυσκολίες",
    methodology: "Διαφοροποιημένη Διδασκαλία",
    tone: "Υπομονετικός και ήπιος",
    include: "Πολλαπλά μαθησιακά στυλ, επιλογές υποστήριξης, βοηθητική τεχνολογία",
    exclude: "Προσεγγίσεις ενός μεγέθους για όλους, συντριπτική πολυπλοκότητα"
  },

  special_needs: {
    role: "Ειδικός Παιδαγωγός",
    task: "Προσαρμογή περιεχομένου για ειδικές ανάγκες",
    context: "Μαθητές με μαθησιακές δυσκολίες",
    methodology: "Διαφοροποιημένη Διδασκαλία",
    tone: "Υπομονετικός και ήπιος",
    include: "Οπτικές υποστηρίξεις, αισθητηριακά διαλείμματα, απλοποιημένες οδηγίες, βοηθητική τεχνολογία",
    exclude: "Σύνθετες πολυβηματικές εργασίες, χρονική πίεση, αφηρημένες έννοιες χωρίς υποστήριξη"
  },

  revision: {
    role: "Καθηγητής/τρια Λυκείου",
    task: "Δημιουργία δραστηριοτήτων επανάληψης",
    context: "Μαθητές που προετοιμάζονται για εξετάσεις",
    methodology: "Διαφοροποιημένη Διδασκαλία",
    tone: "Παρακινητικός και εμπνευστικός",
    include: "Ποικιλία μεθόδων επανάληψης, ευκαιρίες αυτοαξιολόγησης, περιλήψεις βασικών εννοιών",
    exclude: "Μόνο παθητική ανάγνωση, υπερφόρτωση πληροφοριών"
  }
};

    // Handle template selection

    document.getElementById('template').addEventListener('change', function() {

      const selectedTemplate = this.value;

      if (selectedTemplate && templates[selectedTemplate]) {

        const template = templates[selectedTemplate];

        

        // Fill form fields

        document.getElementById('role').value = template.role;

        document.getElementById('task').value = template.task;

        document.getElementById('context').value = template.context;

        document.getElementById('methodology').value = template.methodology;

        document.getElementById('tone').value = template.tone;

        document.getElementById('include').value = template.include;

        document.getElementById('exclude').value = template.exclude;

        

        // Show visual feedback

        this.classList.add('bg-green-50', 'border-green-300');

        setTimeout(() => {

          this.classList.remove('bg-green-50', 'border-green-300');

        }, 2000);

      } else {

        // Clear form if "Create from scratch" is selected

        document.getElementById('role').value = '';

        document.getElementById('task').value = '';

        document.getElementById('context').value = '';

        document.getElementById('methodology').value = '';

        document.getElementById('tone').value = '';

        document.getElementById('include').value = '';

        document.getElementById('exclude').value = '';

      }

    });



    // Toggle "Other" fields

    function toggleOther(selectId, inputId) {

      const select = document.getElementById(selectId);

      const input = document.getElementById(inputId);

      select.addEventListener("change", () => {

        input.classList.toggle("hidden", !select.value.includes("Other"));

      });

    }



    toggleOther("role", "roleOther");

    toggleOther("task", "taskOther");

    toggleOther("context", "contextOther");

    toggleOther("methodology", "methodologyOther");

    toggleOther("tone", "toneOther");



    // Show confirmation modal

    function showConfirmationModal() {

      const modal = document.getElementById('confirmationModal');

      modal.classList.remove('hidden');

      // Add animation class

      setTimeout(() => {

        modal.querySelector('.transform').classList.remove('scale-95');

        modal.querySelector('.transform').classList.add('scale-100');

      }, 10);

    }



    // Close confirmation modal

    function closeConfirmationModal() {

      const modal = document.getElementById('confirmationModal');

      modal.querySelector('.transform').classList.remove('scale-100');

      modal.querySelector('.transform').classList.add('scale-95');

      setTimeout(() => {

        modal.classList.add('hidden');

      }, 300);

    }



    // Copy to clipboard function with confirmation

    function copyToClipboard() {
  const promptText = document.getElementById('outputPrompt').textContent;
  navigator.clipboard.writeText(promptText).then(() => {
    // Track copy success
    trackCopySuccess();
    showConfirmationModal();
  }).catch(err => {
    console.error('Failed to copy text: ', err);
    alert('Prompt copied to clipboard!');
  });
}

// Add this new function
async function trackCopySuccess() {
  try {
    await fetch("/track-copy/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCSRFToken(),
      },
      credentials: "same-origin"
    });
    
    // Check if we should show training needs survey
    checkAndShowTrainingNeeds();
    
  } catch (error) {
    console.log('Copy tracking failed:', error);
  }
}

function checkAndShowTrainingNeeds() {
  if (typeof SURVEYS_ENABLED !== 'undefined' && !SURVEYS_ENABLED) {
    console.log('Surveys are disabled - training needs will not show');
    return;
  }
  console.log('checkAndShowTrainingNeeds called');
  console.log('trainingNeedsShown:', trainingNeedsShown);
  console.log('hasCompletedOnboarding:', hasCompletedOnboarding());
  console.log('hasCompletedTrainingNeeds:', hasCompletedTrainingNeeds());
  
  // Only show once per session, and only if onboarding was completed
  if (!trainingNeedsShown && hasCompletedOnboarding() && !hasCompletedTrainingNeeds()) {
    console.log('All conditions met - showing modal in 2 seconds');
    // 2-second delay after copy confirmation modal
    setTimeout(() => {
      showTrainingNeedsModal();
    }, 2000);
  } else {
    console.log('Conditions not met - modal will not show');
  }
}

function hasCompletedOnboarding() {
  // Check session storage or could check via backend
  return sessionStorage.getItem('onboarding_completed') === 'true' ||
         sessionStorage.getItem('onboarding_shown') === 'true';
}

function hasCompletedTrainingNeeds() {
  // Prevent showing multiple times
  return sessionStorage.getItem('training_needs_completed') === 'true';
}

function showTrainingNeedsModal() {
  if (typeof SURVEYS_ENABLED !== 'undefined' && !SURVEYS_ENABLED) {
    console.log('Surveys are disabled - training modal will not show');
    return;
  }
  console.log('showTrainingNeedsModal called');
  
  const modal = document.getElementById('trainingNeedsModal');
  const modalContent = document.getElementById('trainingModalContent');
  
  console.log('modal element:', modal);
  console.log('modalContent element:', modalContent);
  
  if (!modal) {
    console.log('ERROR: trainingNeedsModal not found!');
    return;
  }
  
  modal.classList.remove('hidden');
  trainingNeedsShown = true;
  
  console.log('Modal should be visible now');
  
  // Animation
  setTimeout(() => {
    if (modalContent) {
      modalContent.classList.remove('scale-95');
      modalContent.classList.add('scale-100');
    }
  }, 10);
  
  // Setup dynamic form behavior
  //setupTrainingFormInteractions(); //old
}
function setupTrainingFormInteractions() {
  const checkboxes = document.querySelectorAll('.training-checkbox');
  const priorityDropdowns = document.querySelectorAll('.priority-dropdown');
  const priorityMessage = document.getElementById('priorityMessage');
  const priorityCount = document.getElementById('priorityCount');
  const otherCheckbox = document.querySelector('input[name="training_interests"][value="other"]');
  const otherTextInput = document.getElementById('trainingOtherText');
  
  // Show/hide priority dropdowns based on checkbox selection
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const parentOption = this.closest('.training-option');
      const dropdown = parentOption.querySelector('.priority-dropdown');
      
      if (this.checked) {
        dropdown.classList.remove('hidden');
        if (this.value === 'other') {
          otherTextInput.classList.remove('hidden');
        }
      } else {
        dropdown.classList.add('hidden');
        dropdown.value = '';
        if (this.value === 'other') {
          otherTextInput.classList.add('hidden');
          otherTextInput.value = '';
        }
      }
      
      updatePriorityCount();
    });
  });
  
  // Handle priority selection and validation
  priorityDropdowns.forEach(dropdown => {
    dropdown.addEventListener('change', function() {
      if (this.value) {
        // Clear any other dropdown with the same priority
        priorityDropdowns.forEach(otherDropdown => {
          if (otherDropdown !== this && otherDropdown.value === this.value) {
            otherDropdown.value = '';
          }
        });
      }
      updatePriorityCount();
    });
  });
  
  function updatePriorityCount() {
    const selectedPriorities = Array.from(priorityDropdowns)
      .filter(dropdown => dropdown.value && !dropdown.classList.contains('hidden'))
      .length;
    
    priorityCount.textContent = selectedPriorities;
    
    if (selectedPriorities > 0) {
      priorityMessage.classList.remove('hidden');
      
      if (selectedPriorities > 3) {
        priorityMessage.classList.add('text-red-600');
        priorityMessage.classList.remove('text-gray-600', 'text-green-600');
      } else if (selectedPriorities === 3) {
        priorityMessage.classList.add('text-green-600');
        priorityMessage.classList.remove('text-gray-600', 'text-red-600');
      } else {
        priorityMessage.classList.add('text-gray-600');
        priorityMessage.classList.remove('text-red-600', 'text-green-600');
      }
    } else {
      priorityMessage.classList.add('hidden');
    }
  }
}

// MOVED OUTSIDE - NOW STANDALONE
async function submitTrainingNeeds() {
  const submitBtn = document.querySelector('.btn-submit');
  
  // Get selected interests from step 1
  const selectedInterests = Array.from(document.querySelectorAll('input[name="training_interests"]:checked'))
    .map(checkbox => checkbox.value);
  
  if (selectedInterests.length === 0) {
    alert('Please select at least one area of interest.');
    goToStep1(); // Go back to step 1
    return;
  }
  
  // Get priorities from step 2
  const priorities = {};
  const priorityDropdowns = document.querySelectorAll('.priority-dropdown-step2');
  
  priorityDropdowns.forEach(dropdown => {
    if (dropdown.value) {
      const interest = dropdown.dataset.interest;
      priorities[interest] = parseInt(dropdown.value);
    }
  });
  
  // Validate: should have 0-3 priorities
  const priorityCount = Object.keys(priorities).length;
  if (priorityCount > 3) {
    alert('Please select no more than 3 priorities.');
    return;
  }
  
  // Get other training needs
  const otherText = document.querySelector('input[name="training_other"]').value || null;
  
  // Get email and interview interest
  const followUpEmail = document.querySelector('input[name="follow_up_email"]').value || null;
  const researchInterview = document.querySelector('input[name="research_interview"]').checked;
  
  const requestData = {
    training_interests: selectedInterests,
    training_priorities: priorities,
    training_other_needs: otherText,
    follow_up_email: followUpEmail,
    research_interview_interest: researchInterview
  };
  
  // Show loading state
  submitBtn.textContent = 'Submitting...';
  submitBtn.disabled = true;
  
  try {
    const response = await fetch('/training-needs/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': getCSRFToken(),
      },
      credentials: 'same-origin',
      body: JSON.stringify(requestData)
    });
    
    if (response.ok) {
      sessionStorage.setItem('training_needs_completed', 'true');
      
      // Show success message
      showTrainingSuccessMessage();
      closeTrainingNeedsModal();
      
      console.log('Training needs data saved successfully');
    } else {
      const errorData = await response.json();
      console.error('Training needs submission error:', errorData);
      alert('Error saving your preferences. Please try again.');
    }
    
  } catch (error) {
    console.error('Network error:', error);
    alert('Network error. Please try again later.');
  } finally {
    submitBtn.textContent = 'Submit';
    submitBtn.disabled = false;
  }
}


function showTrainingSuccessMessage() {
  // Simple success notification
  const notification = document.createElement('div');
  notification.className = 'fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50';
  notification.innerHTML = '✅ Thank you! Your training preferences have been saved.';
  
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, 4000);
}

function closeTrainingNeedsModal() {
  const modal = document.getElementById('trainingNeedsModal');
  const modalContent = document.getElementById('trainingModalContent');
  
  modalContent.classList.remove('scale-100');
  modalContent.classList.add('scale-95');
  
  setTimeout(() => {
    modal.classList.add('hidden');
  }, 300);
  
  // Mark as shown to prevent re-showing
  sessionStorage.setItem('training_needs_shown', 'true');
}
  function updatePriorityCount() {
    const selectedPriorities = Array.from(priorityDropdowns)
      .filter(dropdown => dropdown.value && !dropdown.classList.contains('hidden'))
      .length;
    
    priorityCount.textContent = selectedPriorities;
    
    if (selectedPriorities > 0) {
      priorityMessage.classList.remove('hidden');
      
      if (selectedPriorities > 3) {
        priorityMessage.classList.add('text-red-600');
        priorityMessage.classList.remove('text-gray-600', 'text-green-600');
      } else if (selectedPriorities === 3) {
        priorityMessage.classList.add('text-green-600');
        priorityMessage.classList.remove('text-gray-600', 'text-red-600');
      } else {
        priorityMessage.classList.add('text-gray-600');
        priorityMessage.classList.remove('text-red-600', 'text-green-600');
      }
    } else {
      priorityMessage.classList.add('hidden');
    }
  }


    // Close modal when clicking outside

    document.getElementById('confirmationModal').addEventListener('click', function(e) {

      if (e.target === this) {

        closeConfirmationModal();

      }

    });



    // Store current form data for improvements analysis

    let currentFormData = {};
    let trainingNeedsShown = false;



    // Generate prompt function

    async function generateWithGemini() {

      const loadingIndicator = document.getElementById("loadingIndicator");

      const promptContainer = document.getElementById("promptContainer");

      const generateBtn = document.getElementById("generateBtn");

      

      loadingIndicator.classList.remove("hidden");

      promptContainer.style.display = "none";

      generateBtn.disabled = true;

      generateBtn.textContent = "Generating...";

      generateBtn.classList.add("opacity-50", "cursor-not-allowed");



      // Get form values
      const template = document.getElementById("template").value;
      const role = document.getElementById("role").value;
      const roleOther = document.getElementById("roleOther").value;
      const subject = document.getElementById("subject").value;
      const task = document.getElementById("task").value;
      const taskOther = document.getElementById("taskOther").value;
      const context = document.getElementById("context").value;
      const contextOther = document.getElementById("contextOther").value;
      const methodology = document.getElementById("methodology").value;
      const methodologyOther = document.getElementById("methodologyOther").value;
      const tone = document.getElementById("tone").value;
      const toneOther = document.getElementById("toneOther").value;
      const include = document.getElementById("include").value;
      const exclude = document.getElementById("exclude").value;
      // NEW: Get theory selection
      const theoryEnhancement = document.getElementById("theory_enhancement").value;

      // Determine final values

      const finalRole = role === "Other" ? roleOther : role;

      const finalTask = task === "Other" ? taskOther : task;

      const finalContext = context === "Other" ? contextOther : context;

      const finalMethodology = methodology === "Other" ? methodologyOther : methodology;

      const finalTone = tone.includes("Other") ? toneOther : tone;



      // Store form data for improvements analysis

      currentFormData = {

        role: finalRole,

        subject: subject,

        task: finalTask,

        context: finalContext,

        methodology: finalMethodology,

        tone: finalTone,

        include: include,

        exclude: exclude

      };



      // Build examples section

      // Build examples section
let examplesSection = '';
if (include || exclude) {
  examplesSection = '\n\nΠρόσθετες Οδηγίες:';
  if (include) examplesSection += `\n- Να περιλαμβάνει: ${include}`;
  if (exclude) examplesSection += `\n- Να αποφεύγει: ${exclude}`;
}

// Create user input for Gemini
const userInput = `
Δημιούργησε μια σαφή, επαγγελματική προτροπή AI χρησιμοποιώντας ΑΚΡΙΒΩΣ αυτά τα στοιχεία. Μην προσθέσεις επιπλέον στοιχεία ή δημιουργικές πινελιές.

Στοιχεία προς σύνδεση:
- Ρόλος: ${finalRole}
- Θέμα: ${subject}
- Δραστηριότητα: ${finalTask}
- Πλαίσιο: ${finalContext}
- Μεθοδολογία: ${finalMethodology}
- Τόνος: ${finalTone}${examplesSection}

Οδηγίες:
1. Δημιούργησε μια ενιαία, συνεκτική προτροπή που συνδυάζει αυτά τα στοιχεία φυσικά
2. Χρησιμοποίησε σωστή ελληνική γραμματική και σαφή δομή πρότασης
3. ΜΗΝ προσθέσεις στοιχεία που δεν καθορίζονται παραπάνω
4. Κάνε την έτοιμη για αντιγραφή-επικόλληση σε οποιοδήποτε AI chatbot
5. Ξεκίνα με "Είσαι..." και συμπεριέλαβε όλα τα καθορισμένα στοιχεία
6. Κράτησέ την επαγγελματική και εστιασμένη στην εκπαιδευτική εργασία
`;


      try {

        // Make request to Django backend

        const response = await fetch("/generate/", {

          method: "POST",

          headers: {

            "Content-Type": "application/json",

            "X-CSRFToken": getCSRFToken(),

          },

          credentials: "same-origin", 

          // Get enhancement preference

          body: JSON.stringify({ 

            prompt: userInput,
            template: template,
            enhancement: (function() {

              const el = document.querySelector('input[name="enhancement"]:checked');

              return el ? el.value : 'enhanced';

            })(),

            role: finalRole,
            theory_enhancement: theoryEnhancement,
            task: finalTask,
            context: finalContext,
            methodology: finalMethodology,
            subject: subject,
            tone: finalTone

          })

        });



        const data = await response.json();
        //alert(`Frontend received: ${data.response.length} chars\nFirst 100: "${data.response.substring(0, 100)}"`);

        const outputDiv = document.getElementById("outputPrompt");



        if (data.response) {

          outputDiv.textContent = data.response;

          promptContainer.style.display = "block";

        } else {

          outputDiv.textContent = "❌ Sorry, no prompt was generated.";

          promptContainer.style.display = "block";

        }

        

      } catch (error) {

        console.error("❌ Network or unexpected error:", error);

        const outputDiv = document.getElementById("outputPrompt");

        outputDiv.textContent = "❌ Network or unexpected error: " + error.message;

        promptContainer.style.display = "block";

      } finally {

        loadingIndicator.classList.add("hidden");

        generateBtn.disabled = false;

        generateBtn.textContent = "🚀 Generate Prompt";

        generateBtn.classList.remove("opacity-50", "cursor-not-allowed");

      }

    }



    // Show prompt improvements modal

async function showPromptImprovements() {
  const modal = document.getElementById('promptImprovementsModal');
  const loadingIndicator = document.getElementById('theoryLoadingIndicator');
  const theoryContent = document.getElementById('theoryContent');
  
  modal.classList.remove('hidden');
  setTimeout(() => {
    modal.querySelector('.transform').classList.remove('scale-95');
    modal.querySelector('.transform').classList.add('scale-100');
  }, 10);
  
  loadingIndicator.classList.remove('hidden');
  theoryContent.classList.add('hidden');
  
  // Display current configuration
  const configDiv = document.getElementById('promptConfiguration');
  configDiv.innerHTML = `
    <div class="grid grid-cols-2 gap-2 text-sm">
      <div><strong>Ρόλος:</strong> ${currentFormData.role || 'Δεν καθορίστηκε'}</div>
      <div><strong>Θέμα:</strong> ${currentFormData.subject || 'Δεν καθορίστηκε'}</div>
      <div><strong>Δραστηριότητα:</strong> ${currentFormData.task || 'Δεν καθορίστηκε'}</div>
      <div><strong>Πλαίσιο:</strong> ${currentFormData.context || 'Δεν καθορίστηκε'}</div>
      <div><strong>Μεθοδολογία:</strong> ${currentFormData.methodology || 'Δεν καθορίστηκε'}</div>
      <div><strong>Τόνος:</strong> ${currentFormData.tone || 'Δεν καθορίστηκε'}</div>
    </div>
  `;
  
  // Create prompt improvement analysis prompt - ΕΛΛΗΝΙΚΑ
  const improvementPrompt = `
Είσαι ειδικός στη δημιουργία εκπαιδευτικών προτροπών AI. Με βάση αυτήν τη διαμόρφωση προτροπής:
- Ρόλος: ${currentFormData.role}
- Θέμα: ${currentFormData.subject}
- Δραστηριότητα: ${currentFormData.task}
- Πλαίσιο: ${currentFormData.context}
- Μεθοδολογία: ${currentFormData.methodology}
- Τόνος: ${currentFormData.tone}

Παρέχε 3 συγκεκριμένες βελτιώσεις που θα μπορούσε να προσθέσει ο χρήστης στην προτροπή του για να την κάνει πιο αποτελεσματική.

ΣΗΜΑΝΤΙΚΟ: Απάντησε ΜΟΝΟ με JSON, χωρίς καμία άλλη εξήγηση.

Μορφοποίησε την απάντησή σου ως JSON:
{
  "prompt_improvements": "1. Πρώτη βελτίωση\n2. Δεύτερη βελτίωση\n3. Τρίτη βελτίωση"
}

Εστίασε σε πρακτικές προσθήκες όπως: ζήτημα συγκεκριμένων μορφών, αίτημα επιπέδων διαφοροποίησης, προσθήκη κριτηρίων αξιολόγησης, συμπερίληψη χρονικών περιορισμών, κ.λπ.
`;
  
  try {
    // Make request to Django backend for improvement analysis
    const response = await fetch("/generate/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": getCSRFToken(),
      },
      credentials: "same-origin",
      body: JSON.stringify({ prompt: improvementPrompt }),
      signal: AbortSignal.timeout(45000)  // 45 second timeout
    });

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }

    const data = await response.json();
    
    if (data.response) {
      try {
        // ============= ENHANCED CLEANING =============
        
        // Log raw response for debugging
        console.log('=== RAW GEMINI RESPONSE ===');
        console.log('Type:', typeof data.response);
        console.log('Length:', data.response.length);
        console.log('First 200 chars:', data.response.substring(0, 200));
        console.log('Last 200 chars:', data.response.substring(Math.max(0, data.response.length - 200)));
        
        let cleanResponse = data.response.trim();
        
        // Remove markdown code blocks - COMPREHENSIVE
        // Handle: ```json\n{...}\n```
        if (cleanResponse.startsWith('```')) {
          console.log('Detected markdown code block');
          // Remove opening ```json or ```
          cleanResponse = cleanResponse.replace(/^```(?:json)?\s*/i, '');
          // Remove closing ```
          cleanResponse = cleanResponse.replace(/\s*```\s*$/i, '');
          cleanResponse = cleanResponse.trim();
          console.log('After markdown removal:', cleanResponse.substring(0, 100));
        }
        
        // Remove any remaining backticks
        cleanResponse = cleanResponse.replace(/`/g, '');
        
        // Final trim
        cleanResponse = cleanResponse.trim();
        
        console.log('=== CLEANED RESPONSE FOR PARSING ===');
        console.log('First 300 chars:', cleanResponse.substring(0, 300));
        
        // Parse JSON
        const mainData = JSON.parse(cleanResponse);
        
        console.log('✅ JSON parsed successfully:', mainData);
        
        // Get improvements text and clean it up
        let improvementsText = mainData.prompt_improvements || "";
        
        if (!improvementsText || improvementsText.trim() === '') {
          throw new Error('Empty prompt_improvements field');
        }
        
        // Clean up JSON formatting
        improvementsText = improvementsText.replace(/^["\s]*/, '').replace(/["\s}]*$/, '');
        improvementsText = improvementsText.replace(/\\n/g, '\n').replace(/\\"/g, '"');
        
        console.log('Improvements text:', improvementsText);
        
        // Split improvements by numbered list (1., 2., 3.) and remove first empty/invalid item
        const improvementItems = improvementsText.split(/(?=\d+\.\s+)/)
          .filter(item => item.trim())
          .filter(item => /^\d+\./.test(item.trim())); // Only keep items that start with "1.", "2.", etc.
        
        console.log('Parsed improvement items:', improvementItems.length, 'items');
        
        // Create checkboxes for each improvement
        const improvementsList = document.getElementById('improvementsList');
        improvementsList.innerHTML = '';
        
        if (improvementItems.length > 0) {
          improvementItems.slice(0, 3).forEach((improvement, index) => {
            if (improvement.trim()) {
              const checkboxHtml = `
                  <div class="flex items-start space-x-3 mb-3">
                    <input type="checkbox" id="improvement${index}" class="mt-1 flex-shrink-0" data-improvement="${improvement.trim().replace(/"/g, '&quot;')}">
                    <label for="improvement${index}" class="text-sm text-gray-700 cursor-pointer leading-relaxed break-words">
                      ${improvement.trim().replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
                    </label>
                  </div>
                `;
              improvementsList.innerHTML += checkboxHtml;
            }
          });
          console.log('✅ Improvements displayed successfully');
        } else {
          console.warn('⚠️ No valid improvement items found');
          improvementsList.innerHTML = '<p class="text-gray-600">Δεν υπάρχουν διαθέσιμες βελτιώσεις αυτή τη στιγμή.</p>';
        }
        
      } catch (jsonError) {
        // ============= ENHANCED ERROR HANDLING =============
        console.error('❌ JSON PARSING ERROR');
        console.error('Error name:', jsonError.name);
        console.error('Error message:', jsonError.message);
        console.error('Error stack:', jsonError.stack);
        console.error('Response that failed to parse:', data.response);
        
        const improvementsList = document.getElementById('improvementsList');
        improvementsList.innerHTML = `
          <div class="bg-red-50 border border-red-200 rounded-lg p-4">
            <p class="text-red-800 font-semibold mb-2">Σφάλμα ανάλυσης βελτιώσεων</p>
            <p class="text-red-700 text-sm mb-3">Παρακαλώ δοκιμάστε ξανά.</p>
            <details class="text-xs">
              <summary class="cursor-pointer text-red-600 hover:text-red-800 font-mono">Τεχνικές λεπτομέρειες (F12 Console για περισσότερα)</summary>
              <div class="mt-2 bg-white p-2 rounded border border-red-200 overflow-auto max-h-40">
                <p><strong>Error:</strong> ${jsonError.message}</p>
                <p class="mt-1"><strong>Response preview:</strong></p>
                <pre class="text-xs mt-1 whitespace-pre-wrap">${data.response.substring(0, 500)}</pre>
              </div>
            </details>
          </div>
        `;
      }
    } else {
      console.error('❌ No response from API');
      const improvementsList = document.getElementById('improvementsList');
      improvementsList.innerHTML = '<p class="text-gray-600">Δεν λήφθηκε απάντηση. Παρακαλώ δοκιμάστε ξανά.</p>';
    }
    
  } catch (error) {
    console.error('❌ IMPROVEMENT ANALYSIS ERROR');
    console.error('Error type:', error.name);
    console.error('Error message:', error.message);
    console.error('Full error:', error);
    
    const improvementsList = document.getElementById('improvementsList');
    if (improvementsList) {
      improvementsList.innerHTML = '<p class="text-gray-600">Αδυναμία ανάλυσης βελτιώσεων αυτή τη στιγμή. Ελέγξτε τη σύνδεση δικτύου.</p>';
    }
  } finally {
    loadingIndicator.classList.add('hidden');
    theoryContent.classList.remove('hidden');
  }
}
    // Apply selected improvements to the original prompt

async function applySelectedImprovements() {

  const checkboxes = document.querySelectorAll('#improvementsList input[type="checkbox"]:checked');

  

  if (checkboxes.length === 0) {

    alert('Παρακαλώ επιλέξτε τουλάχιστον μία βελτίωση για εφαρμογή.');

    return;

  }

  

  // Get selected improvements

  //const selectedImprovements = Array.from(checkboxes).map(cb => cb.value);
  const selectedImprovements = Array.from(checkboxes).map(cb => cb.dataset.improvement);

  const originalPrompt = document.getElementById('outputPrompt').textContent;

  

  // Create enhancement prompt for Gemini

  const enhancementPrompt = `

Take this original prompt and enhance it by incorporating these specific improvements:



Original prompt:

${originalPrompt}



Improvements to incorporate:

${selectedImprovements.map((imp, index) => `- ${imp}`).join('\n')}



Return only the improved prompt, ready to use. Do not include explanations or additional text.

  `;

  

  try {

    // Show loading in the modal

    const improvementsList = document.getElementById('improvementsList');

    improvementsList.innerHTML = '<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div><p class="mt-2 text-gray-600">Applying improvements...</p></div>';

    

    // Call Gemini API

    const response = await fetch("/generate/", {

      method: "POST",

      headers: {

        "Content-Type": "application/json",

        "X-CSRFToken": getCSRFToken(),

      },

      credentials: "same-origin", 

      body: JSON.stringify({ prompt: enhancementPrompt })

    });



    const data = await response.json();

    // TEMPORARY DEBUG - θα το αφαιρέσουμε μετά
    //alert("Raw response: " + JSON.stringify(data.response, null, 2));

    if (data.response) {

      // Update the main prompt textarea with improved version

      document.getElementById('outputPrompt').textContent = data.response;

      

      // Close the improvements modal

      closePromptImprovementsModal();

      

      // Show success message

      alert('Prompt improved successfully! You can now edit it further if needed.');

    } else {

      throw new Error('No response received');

    }

    

  } catch (error) {

    console.error('Error applying improvements:', error);

    alert('Error applying improvements. Please try again.');

    

    // Restore the improvements list on error

    showPromptImprovements();

  }

}

    // Close prompt improvements modal

    function closePromptImprovementsModal() {

      const modal = document.getElementById('promptImprovementsModal');

      modal.querySelector('.transform').classList.remove('scale-100');

      modal.querySelector('.transform').classList.add('scale-95');

      setTimeout(() => {

        modal.classList.add('hidden');

      }, 300);

    }



    // Close modal when clicking outside

    document.getElementById('promptImprovementsModal').addEventListener('click', function(e) {

      if (e.target === this) {

        closePromptImprovementsModal();

      }

    });



    // CSRF token function

    function getCSRFToken() {

      const name = "csrftoken";

      const cookies = document.cookie.split(';');

      for (let cookie of cookies) {

        const trimmed = cookie.trim();

        if (trimmed.startsWith(name + '=')) {

          return decodeURIComponent(trimmed.substring(name.length + 1));

        }

      }

      return '';

    }

  </script>
<script>
// Educational Theory Information Database
const theoryInfo = {
  blooms: {
    title: "Ταξινομία Bloom",
    description: "Δομεί τη μάθηση από βασική ανάκληση σε δημιουργική σκέψη, βοηθώντας τους μαθητές να προχωρούν συστηματικά μέσω γνωστικών επιπέδων. Ιδανική για οικοδόμηση ολοκληρωμένων μαθησιακών εμπειριών.",
    educational_value: "Βοηθά στη δόμηση ερωτήσεων από βασική ανάκληση σε δημιουργική σκέψη, καθιστώντας τη μάθηση πιο συστηματική και προοδευτική για τους μαθητές.",
    suitable_for: ["κριτική σκέψη", "ερωτήσεις", "αξιολόγηση", "σχέδιο μαθήματος", "ανάλυση", "αξιολόγηση"]
  },
  udl: {
    title: "Καθολικός Σχεδιασμός για τη Μάθηση (UDL)",
    description: "Παρέχει πολλαπλούς τρόπους για τους μαθητές να έχουν πρόσβαση, να αλληλεπιδράσουν και να επιδείξουν μάθηση. Απαραίτητο για συμπεριληπτικές τάξεις με ποικίλους μαθητές.",
    educational_value: "Διασφαλίζει ότι όλοι οι μαθητές μπορούν να έχουν πρόσβαση στο περιεχόμενο μέσω πολλαπλών διαδρομών - απαραίτητο όταν διδάσκετε ποικίλες ομάδες μαθητών με διαφορετικές ανάγκες.",
    suitable_for: ["μικτό επίπεδο", "ειδικές ανάγκες", "διαφοροποιημένη", "συμπεριληπτική", "ποικίλη", "μαθησιακές δυσκολίες"]
  },
  track: {
    title: "Πλαίσιο TPACK",
    description: "Ενσωματώνει Τεχνολογία, Παιδαγωγική και Γνώση Περιεχομένου για ουσιαστική χρήση τεχνολογίας στην εκπαίδευση, διασφαλίζοντας ότι η τεχνολογία ενισχύει αντί να αντικαθιστά τη διδασκαλία.",
    educational_value: "Σας βοηθά να ενσωματώσετε ουσιαστικά την τεχνολογία με τις διδακτικές μεθόδους σας, αντί να προσθέτετε απλώς τεχνολογία χάριν της τεχνολογίας.",
    suitable_for: ["τεχνολογία", "ψηφιακή", "gamified", "online", "διαδραστική", "ai"]
  },
  constructivist: {
    title: "Κατασκευαστική Μάθηση",
    description: "Οι μαθητές χτίζουν ενεργά γνώση μέσω πρακτικής ανακάλυψης και ουσιαστικών συνδέσεων. Ιδανική για διερευνητικές προσεγγίσεις και επίλυση προβλημάτων.",
    educational_value: "Υποστηρίζει την ενεργή κατασκευή γνώσης όπου οι μαθητές χτίζουν κατανόηση μέσω ανακάλυψης αντί για παθητική ακρόαση.",
    suitable_for: ["διερευνητική", "ανακάλυψη", "πρόβλημα", "εξερεύνηση", "διερεύνηση", "πρακτική"]
  },
  social_learning: {
    title: "Θεωρία Κοινωνικής Μάθησης",
    description: "Αξιοποιεί την αλληλεπίδραση μεταξύ συνομηλίκων και τη συνεργασία για βαθύτερη μάθηση. Οι μαθητές μαθαίνουν μέσω παρατήρησης, συζήτησης και κοινής κατασκευής γνώσης.",
    educational_value: "Αξιοποιεί τη δύναμη της αλληλεπίδρασης και της συνεργασίας μεταξύ συνομηλίκων, καθώς οι μαθητές συχνά μαθαίνουν αποτελεσματικά ο ένας από τον άλλον.",
    suitable_for: ["συνεργατική", "ομάδα", "συνομήλικοι", "συζήτηση", "ομαδική εργασία", "κοινωνική"]
  },
  scaffolding: {
    title: "Υποστήριξη (Scaffolding)",
    description: "Παρέχει προσωρινές δομές υποστήριξης που μειώνονται σταδιακά καθώς οι μαθητές αναπτύσσουν αυτονομία. Σαν βοηθητικές ρόδες για τη μάθηση νέων δεξιοτήτων.",
    educational_value: "Παρέχει προσωρινή υποστήριξη που μειώνεται σταδιακά καθώς οι μαθητές αναπτύσσουν αυτονομία - σαν βοηθητικές ρόδες για τη μάθηση.",
    suitable_for: ["υποστήριξη", "καθοδήγηση", "βήμα-προς-βήμα", "σταδιακή", "coaching", "αρχάριος"]
  },
};

// NEW: Methodology Information Database
const methodologyInfo = {
  "Άμεση Διδασκαλία": {
    description: "Ο εκπαιδευτικός παρέχει ρητή, δομημένη καθοδήγηση με σαφή βήματα και άμεση ανατροφοδότηση. Ιδανική για νέες έννοιες που χρειάζονται συστηματική εξήγηση.",
    when_to_use: "Χρησιμοποίησε για: βασικές δεξιότητες, νέες έννοιες, συστηματική διδασκαλία"
  },
  "Διερευνητική Μάθηση": {
    description: "Οι μαθητές εξερευνούν και ανακαλύπτουν γνώση μέσω ερωτήσεων και διερεύνησης. Αναπτύσσει κριτική σκέψη και ικανότητες επίλυσης προβλημάτων.",
    when_to_use: "Χρησιμοποίησε για: κριτική σκέψη, ερωτήσεις, ανάλυση, ανακάλυψη"
  },
  "Συνεργατική Μάθηση": {
    description: "Οι μαθητές συνεργάζονται σε ομάδες για να επιτύχουν κοινούς στόχους μαθησιακούς. Αναπτύσσει κοινωνικές δεξιότητες και βαθύτερη κατανόηση μέσω διάλογου.",
    when_to_use: "Χρησιμοποίησε για: ομαδική εργασία, συζητήσεις, peer learning, κοινωνικές δεξιότητες"
  },
  "Μάθηση Βασισμένη σε Προβλήματα": {
    description: "Οι μαθητές μαθαίνουν μέσω επίλυσης αυθεντικών προβλημάτων πραγματικού κόσμου. Αναπτύσσει δεξιότητες επίλυσης προβλημάτων και κριτικής σκέψης.",
    when_to_use: "Χρησιμοποίησε για: εφαρμογές πραγματικού κόσμου, σύνθετα προβλήματα, αυθεντικές προκλήσεις"
  },
  "Μάθηση Βασισμένη σε Έργα": {
    description: "Οι μαθητές δημιουργούν εκτεταμένα έργα που ενσωματώνουν πολλαπλές δεξιότητες και γνώσεις. Προάγει τη δημιουργικότητα και την αυτονομία.",
    when_to_use: "Χρησιμοποίησε για: δημιουργικά έργα, μακροχρόνιες εργασίες, ολοκληρωμένες δραστηριότητες"
  },
  "Gamified Learning (Παιχνιδοποίηση)": {
    description: "Χρήση στοιχείων παιχνιδιού (πόντοι, επίπεδα, προκλήσεις) για αύξηση της δέσμευσης και κινήτρων των μαθητών.",
    when_to_use: "Χρησιμοποίησε για: αύξηση κινήτρων, εμπλοκή μαθητών, επανάληψη"
  },
  "Διαφοροποιημένη Διδασκαλία": {
    description: "Προσαρμογή της διδασκαλίας για να καλύψει ποικίλες ανάγκες, ικανότητες και ενδιαφέροντα μαθητών. Αναγνωρίζει ότι κάθε μαθητής μαθαίνει διαφορετικά.",
    when_to_use: "Χρησιμοποίησε για: μικτές τάξεις, πολλαπλά επίπεδα, διαφορετικές μαθησιακές ανάγκες"
  },
  "Τεχνολογικά Υποστηριζόμενη Άμεση Διδασκαλία": {
    description: "Συνδυασμός δομημένης διδασκαλίας με ψηφιακά εργαλεία για ενισχυμένη ανατροφοδότηση και εξάσκηση.",
    when_to_use: "Χρησιμοποίησε για: ψηφιακή διδασκαλία, προσαρμοστική εξάσκηση, άμεση ανατροφοδότηση"
  },
  "Ψηφιακή Συνεργατική Μάθηση": {
    description: "Συνεργασία μέσω ψηφιακών πλατφορμών και εργαλείων. Επιτρέπει σύγχρονη και ασύγχρονη αλληλεπίδραση.",
    when_to_use: "Χρησιμοποίησε για: online συνεργασία, απομακρυσμένη μάθηση, ψηφιακά έργα"
  },
  "Ψηφιακή Διερευνητική Μάθηση": {
    description: "Χρήση ψηφιακών εργαλείων για διερεύνηση, έρευνα και ανακάλυψη. Παρέχει πρόσβαση σε πλούσιες πηγές πληροφοριών.",
    when_to_use: "Χρησιμοποίησε για: ψηφιακή έρευνα, online διερεύνηση, πρόσβαση σε πηγές"
  },
  "Τεχνολογικά Ενισχυμένη Επίλυση Προβλημάτων": {
    description: "Χρήση προσαρμοστικών ψηφιακών εργαλείων για επίλυση προβλημάτων με άμεση ανατροφοδότηση και προσαρμοσμένη δυσκολία.",
    when_to_use: "Χρησιμοποίησε για: προσαρμοστική εξάσκηση, προσωποποιημένη μάθηση, simulation"
  },
  "Τεχνολογικά Ενισχυμένη Αξιολόγηση": {
    description: "Ψηφιακά εργαλεία αξιολόγησης που παρέχουν άμεση ανατροφοδότηση και αναλυτικά στοιχεία για τη μαθησιακή πρόοδο.",
    when_to_use: "Χρησιμοποίησε για: formative assessment, άμεση ανατροφοδότηση, data-driven decisions"
  },
  "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία": {
    description: "Χρήση αλγορίθμων και AI για αυτόματη προσαρμογή του περιεχομένου και της δυσκολίας στις ανάγκες κάθε μαθητή.",
    when_to_use: "Χρησιμοποίησε για: εξατομικευμένη μάθηση, προσαρμοστική δυσκολία, personalized pathways"
  }
};

// NEW: Show methodology explanation when selected
function showMethodologyInfo(methodologyText) {
  const infoDiv = document.getElementById('methodology_info');
  const descDiv = document.getElementById('methodology_description');
  const whenDiv = document.getElementById('methodology_when');
  
  if (methodologyText && methodologyInfo[methodologyText]) {
    const info = methodologyInfo[methodologyText];
    descDiv.textContent = info.description;
    whenDiv.textContent = info.when_to_use;
    infoDiv.classList.remove('hidden');
  } else {
    infoDiv.classList.add('hidden');
  }
}
// Smart Theory Recommendation Logic - ΕΛΛΗΝΙΚΑ
// Smart Theory Recommendation Logic with Conflict Avoidance
function suggestRelevantTheory(methodology, task, context) {
  const methodologyLower = methodology.toLowerCase();
  const taskLower = task.toLowerCase();
  const contextLower = context.toLowerCase();
  
  // ===== CONFLICT AVOIDANCE: Methodology-based exclusions FIRST =====
  
  // If using Collaborative methodology, DON'T suggest Social Learning (redundant)
  if (methodologyLower.includes('συνεργατική') || methodologyLower.includes('ομάδ') || methodologyLower.includes('ψηφιακή συνεργατική')) {
    // Instead, check task for complementary theories
    if (taskLower.includes('κριτική σκέψη') || taskLower.includes('ανάλυση') || taskLower.includes('αξιολόγηση')) {
      return 'blooms';
    }
    if (contextLower.includes('μικτό επίπεδο') || contextLower.includes('ειδικές ανάγκες')) {
      return 'udl';
    }
    return 'scaffolding'; // Complementary, not redundant
  }
  
  // If using Inquiry methodology, DON'T suggest Constructivist (overlap)
  if (methodologyLower.includes('διερευνητική') || methodologyLower.includes('εξερεύνηση') || methodologyLower.includes('ψηφιακή διερευνητική')) {
    // Suggest Bloom's as complementary
    return 'blooms';
  }
  
  // If using Differentiated methodology, suggest UDL (related but distinct - accessibility focus)
  if (methodologyLower.includes('διαφοροποιημένη')) {
    return 'udl';
  }
  
  // ===== TASK-BASED SUGGESTIONS (Priority after conflict avoidance) =====
  
  if (taskLower.includes('κριτική σκέψη') || taskLower.includes('ερωτήσεων κριτικής') || taskLower.includes('ανάλυση')) {
    return 'blooms';
  }
  if (taskLower.includes('αξιολόγηση') || taskLower.includes('κουίζ') || taskLower.includes('ρουμπρίκα')) {
    return 'blooms';
  }
  if (taskLower.includes('σχέδιο μαθήματος') || taskLower.includes('πλήρους σχεδίου') || taskLower.includes('πλάνο')) {
    return 'blooms';
  }
  if (taskLower.includes('φύλλο εργασίας') || taskLower.includes('ολοκληρωμένου φύλλου')) {
    return 'udl'; // Changed from differentiation to UDL
  }
  if (taskLower.includes('διαφοροποιημέν') || taskLower.includes('πολλαπλές νοημοσύνες')) {
    return 'udl'; // Changed from differentiation to UDL
  }
  if (taskLower.includes('ομαδικές δραστηριότητες') || taskLower.includes('ομαδική εργασία')) {
    return 'social_learning';
  }
  if (taskLower.includes('επίλυση προβλημάτων') || taskLower.includes('σεναρί') || taskLower.includes('πρόβλημα')) {
    return 'constructivist';
  }
  if (taskLower.includes('ασκήσεις') || taskLower.includes('εξάσκηση') || taskLower.includes('εξάσκησης')) {
    return 'scaffolding';
  }
  if (taskLower.includes('δημιουργική γραφή') || taskLower.includes('προτροπών')) {
    return 'constructivist';
  }
  if (taskLower.includes('συζήτηση') || taskLower.includes('επιχειρήματ') || taskLower.includes('θέματα')) {
    return 'social_learning';
  }
  if (taskLower.includes('μελέτ') || taskLower.includes('περίπτωση')) {
    return 'constructivist';
  }
  
  // ===== METHODOLOGY-BASED SUGGESTIONS (Fallback for non-conflicting cases) =====
  
  if (methodologyLower.includes('τεχνολογία') || methodologyLower.includes('ψηφιακή') || methodologyLower.includes('ai') || methodologyLower.includes('τεχνολογικά')) {
    return 'tpack';
  }
  if (methodologyLower.includes('προβλήματα') || methodologyLower.includes('problem')) {
    return 'constructivist';
  }
  if (methodologyLower.includes('έργα') || methodologyLower.includes('project')) {
    return 'constructivist';
  }
  if (methodologyLower.includes('gamified') || methodologyLower.includes('παιχνιδοποί')) {
    return 'scaffolding';
  }
  if (methodologyLower.includes('προσαρμοστική') || methodologyLower.includes('adaptive')) {
    return 'udl';
  }
  
  // ===== CONTEXT-BASED SUGGESTIONS (Final fallback) =====
  
  if (contextLower.includes('μικτό επίπεδο') || contextLower.includes('ειδικές ανάγκες') || contextLower.includes('μαθησιακές δυσκολίες')) {
    return 'udl';
  }
  if (contextLower.includes('3-5') || contextLower.includes('νηπιαγωγείο')) {
    return 'scaffolding';
  }
  
  // Default
  return 'blooms';
}
// Update theory recommendation when methodology/task changes - ΕΛΛΗΝΙΚΑ
function updateTheoryRecommendation() {
  const methodology = document.getElementById('methodology').value;
  const task = document.getElementById('task').value;
  const context = document.getElementById('context').value;
  const recommendationDiv = document.getElementById('theory_recommendation');
  const recommendationText = document.getElementById('recommendation_text');
  const theoryDropdown = document.getElementById('theory_enhancement');
  
  if (methodology || task) {
    const suggestedTheory = suggestRelevantTheory(methodology, task, context);
    const theoryData = theoryInfo[suggestedTheory];
    
    // Fixed logic: Only respect user selection if they MANUALLY clicked the dropdown
    const isUserSelected = theoryDropdown.dataset.userSelected === 'true';
    
    if (!isUserSelected) {
      // Auto-select the suggested theory (whether dropdown is empty or has auto-selected value)
      theoryDropdown.value = suggestedTheory;
      
      recommendationText.innerHTML = `
        <strong>${theoryData.title}</strong> επιλέχθηκε αυτόματα.<br>
        ${theoryData.educational_value}
      `;
      
      // Also show the theory info
      showTheoryInfo(suggestedTheory);
    } else {
      // User has manually selected a theory, just show recommendation
      const currentValue = theoryDropdown.value;
      const currentTheoryData = theoryInfo[currentValue];
      
      if (suggestedTheory !== currentValue) {
        recommendationText.innerHTML = `
          Χρησιμοποιείτε <strong>${currentTheoryData?.title || 'επιλεγμένη θεωρία'}</strong>.<br>
          💡 Νέα πρόταση: <strong>${theoryData.title}</strong> - ${theoryData.educational_value}
        `;
      } else {
        recommendationText.innerHTML = `
          <strong>${theoryData.title}</strong> ταιριάζει με την επιλογή σας - εξαιρετική επιλογή!<br>
          ${theoryData.educational_value}
        `;
      }
    }
    
    recommendationDiv.classList.remove('hidden');
  } else {
    recommendationDiv.classList.add('hidden');
  }
}

// Show theory information when selected - ΗΔΗ ΛΕΙΤΟΥΡΓΕΙ
function showTheoryInfo(theoryKey) {
  const infoDiv = document.getElementById('theory_info');
  const titleDiv = document.getElementById('theory_title');
  const descDiv = document.getElementById('theory_description');
  
  if (theoryKey && theoryInfo[theoryKey]) {
    const theory = theoryInfo[theoryKey];
    titleDiv.textContent = theory.title;
    descDiv.textContent = theory.description;
    infoDiv.classList.remove('hidden');
  } else {
    infoDiv.classList.add('hidden');
  }
}

// Toggle theory selection visibility based on enhancement choice
function toggleTheorySelection() {
  const enhancementRadio = document.querySelector('input[name="enhancement"]:checked');
  const theorySection = document.getElementById('theory_selection_section');
  
  if (enhancementRadio && enhancementRadio.value === 'enhanced') {
    theorySection.classList.remove('hidden');
    updateTheoryRecommendation(); // Show recommendation when enhanced is selected
  } else {
    theorySection.classList.add('hidden');
    document.getElementById('theory_recommendation').classList.add('hidden');
    document.getElementById('theory_info').classList.add('hidden');
  }
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
  // Initial setup
  toggleTheorySelection();
  
  // Enhancement radio change
  document.querySelectorAll('input[name="enhancement"]').forEach(radio => {
    radio.addEventListener('change', toggleTheorySelection);
  });
  
  // Form field changes for recommendations
document.getElementById('methodology').addEventListener('change', function() {
  // NEW: Show methodology explanation
  showMethodologyInfo(this.value);
  
  // Hide methodology suggestion when user manually changes
  if (this.value !== '') {
    document.getElementById('methodology_suggestion').classList.add('hidden');
  }
  
  // Reset theory user-selection flag
  delete document.getElementById('theory_enhancement').dataset.userSelected;
  
  // Update theory recommendation
  updateTheoryRecommendation();
});
  
  document.getElementById('context').addEventListener('change', function() {
    // Καθάρισε το user-selected flag όταν αλλάζει το context
    delete document.getElementById('theory_enhancement').dataset.userSelected;
    updateTheoryRecommendation();
  });
  
  // IMPORTANT: Also listen to template changes
  document.getElementById('template').addEventListener('change', function() {
    // Καθάρισε το user-selected flag όταν αλλάζει το template
    delete document.getElementById('theory_enhancement').dataset.userSelected;
    
    // Template changes trigger methodology changes programmatically
    // We need to manually trigger the recommendation update
    setTimeout(() => {
      updateTheoryRecommendation();
    }, 100); // Small delay to ensure template has updated the fields
  });
  
  // Theory selection change
  document.getElementById('theory_enhancement').addEventListener('change', function() {
    showTheoryInfo(this.value);
    
    if (this.value !== '') {
      // Mark as user-selected when they manually choose a theory
      this.dataset.userSelected = 'true';
      document.getElementById('theory_recommendation').classList.add('hidden');
    } else {
      // If they go back to auto-select, remove the user-selected flag
      delete this.dataset.userSelected;
      updateTheoryRecommendation();
    }
  });
});
</script>
<script>
// Research-backed methodology suggestions for templates
const methodologyResearch = {
  // BULLETPROOF (Research-backed) connections
  critical_questions: {
    suggested: "Διερευνητική Μάθηση",
    rationale: "Η έρευνα δείχνει ότι η διερευνητική μάθηση αναπτύσσει αποτελεσματικά την κριτική σκέψη μέσω σωκρατικής ερώτησης και ανακάλυψης με πρωτοβουλία των μαθητών.",
    alternatives: ["Μάθηση Βασισμένη σε Προβλήματα", "Συνεργατική Μάθηση", "Άμεση Διδασκαλία"]
  },
  
  problem_solving: {
    suggested: "Μάθηση Βασισμένη σε Προβλήματα", 
    rationale: "Η μάθηση βασισμένη σε προβλήματα είναι εξαιρετικά αποτελεσματική για την ανάπτυξη δεξιοτήτων επίλυσης προβλημάτων μέσω αυθεντικών προκλήσεων πραγματικού κόσμου.",
    alternatives: ["Διερευνητική Μάθηση", "Συνεργατική Μάθηση", "Τεχνολογικά Ενισχυμένη Επίλυση Προβλημάτων"]
  },
  
  group_activities: {
    suggested: "Συνεργατική Μάθηση",
    rationale: "Οι δομές συνεργατικής μάθησης προάγουν αποτελεσματικά την αλληλεπίδραση μεταξύ συνομηλίκων, την κοινή κατασκευή γνώσης και την κοινωνική μάθηση.",
    alternatives: ["Ψηφιακή Συνεργατική Μάθηση", "Μάθηση Βασισμένη σε Προβλήματα", "Μάθηση Βασισμένη σε Έργα"]
  },
  
  lesson_plan: {
    suggested: "Άμεση Διδασκαλία",
    rationale: "Η άμεση διδασκαλία παρέχει συστηματική, ρητή διδασκαλία που είναι εξαιρετικά αποτελεσματική για δομημένη παράδοση μαθήματος και απόκτηση γνώσης.",
    alternatives: ["Τεχνολογικά Υποστηριζόμενη Άμεση Διδασκαλία", "Διαφοροποιημένη Διδασκαλία", "Προσεγγίσεις Εστιασμένες στην Αξιολόγηση"]
  },
  
  warm_up: {
    suggested: "Συνεργατική Μάθηση",
    rationale: "Οι δραστηριότητες προθέρμανσης επωφελούνται από την αλληλεπίδραση μεταξύ συνομηλίκων και την κοινωνική δέσμευση για ενεργοποίηση προηγούμενης γνώσης και οικοδόμηση κοινότητας τάξης.",
    alternatives: ["Ψηφιακή Συνεργατική Μάθηση", "Διερευνητική Μάθηση", "Άμεση Διδασκαλία"]
  },
  
  lesson_intro: {
    suggested: "Διερευνητική Μάθηση", 
    rationale: "Οι εισαγωγές νέων θεμάτων είναι πιο ελκυστικές όταν προκαλούν περιέργεια και ενθαρρύνουν ερωτήσεις και εξερεύνηση από τους μαθητές.",
    alternatives: ["Μάθηση Βασισμένη σε Προβλήματα", "Άμεση Διδασκαλία", "Ψηφιακή Διερευνητική Μάθηση"]
  },
  
  debates: {
    suggested: "Συνεργατική Μάθηση",
    rationale: "Οι δραστηριότητες συζήτησης απαιτούν εγγενώς δομημένη αλληλεπίδραση μεταξύ συνομηλίκων, δεξιότητες επιχειρηματολογίας και διαδικασίες κοινωνικής μάθησης.",
    alternatives: ["Ψηφιακή Συνεργατική Μάθηση", "Διερευνητική Μάθηση", "Προσεγγίσεις Εστιασμένες στην Αξιολόγηση"]
  },
  
  practice_exercises: {
    suggested: "Τεχνολογικά Ενισχυμένη Επίλυση Προβλημάτων",
    rationale: "Οι ασκήσεις εξάσκησης επωφελούνται από προσαρμοστική ανατροφοδότηση, εξατομικευμένη προσαρμογή δυσκολίας και άμεση απόκριση διαθέσιμη μέσω ψηφιακών εργαλείων.",
    alternatives: ["Άμεση Διδασκαλία", "Διαφοροποιημένη Διδασκαλία", "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία"]
  },

  worksheet: {
    suggested: "Διαφοροποιημένη Διδασκαλία",
    rationale: "Τα ολοκληρωμένα φύλλα εργασίας απαιτούν πολλαπλούς τύπους δραστηριοτήτων που απευθύνονται σε διαφορετικά μαθησιακά στυλ, γνωστικά επίπεδα και ανάπτυξη δεξιοτήτων - ο πυρήνας της διαφοροποιημένης διδασκαλίας.",
    alternatives: ["Άμεση Διδασκαλία", "Τεχνολογικά Ενισχυμένη Επίλυση Προβλημάτων", "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία"]
  },
  
  creative_writing: {
    suggested: "Μάθηση Βασισμένη σε Έργα",
    rationale: "Η δημιουργική γραφή περιλαμβάνει εκτεταμένες, αυτοκαθοδηγούμενες διαδικασίες δημιουργίας που ευθυγραμμίζονται με τις αρχές της μάθησης βασισμένης σε έργα.",
    alternatives: ["Διερευνητική Μάθηση", "Τεχνολογικά Ενσωματωμένη Εργασία Έργου", "Διαφοροποιημένη Διδασκαλία"]
  },
  
  quiz_assessment: {
    suggested: "Τεχνολογικά Ενισχυμένη Αξιολόγηση",
    rationale: "Τα ψηφιακά εργαλεία αξιολόγησης παρέχουν άμεση ανατροφοδότηση, αναλυτικά στοιχεία δεδομένων και προσαρμοστική ερώτηση που ενισχύουν τα μαθησιακά αποτελέσματα.",
    alternatives: ["Προσεγγίσεις Εστιασμένες στην Αξιολόγηση", "Άμεση Διδασκαλία", "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία"]
  },
  
  rubrics: {
    suggested: "Άμεση Διδασκαλία",
    rationale: "Η δημιουργία κριτηρίων αξιολόγησης απαιτεί συστηματική, ρητή εξήγηση κριτηρίων και προτύπων, ευθυγραμμιζόμενη με τις αρχές της άμεσης διδασκαλίας.",
    alternatives: ["Προσεγγίσεις Εστιασμένες στην Αξιολόγηση", "Τεχνολογικά Ενισχυμένη Αξιολόγηση", "Διαφοροποιημένη Διδασκαλία"]
  },
  
  feedback: {
    suggested: "Τεχνολογικά Ενισχυμένη Αξιολόγηση",
    rationale: "Η αποτελεσματική ανατροφοδότηση απαιτεί εξατομίκευση, έγκαιρη παράδοση και επεκτασιμότητα - δυνατά σημεία των ψηφιακών συστημάτων ανατροφοδότησης.",
    alternatives: ["Προσεγγίσεις Εστιασμένες στην Αξιολόγηση", "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία", "Διαφοροποιημένη Διδασκαλία"]
  },
  
  differentiated: {
    suggested: "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία",
    rationale: "Η αληθινή διαφοροποίηση απαιτεί εξατομικευμένες διαδρομές και ευέλικτη παράδοση περιεχομένου, που επιτυγχάνεται καλύτερα μέσω προσαρμοστικών ψηφιακών συστημάτων.",
    alternatives: ["Διαφοροποιημένη Διδασκαλία", "Τεχνολογικά Υποστηριζόμενη Άμεση Διδασκαλία", "Ψηφιακή Συνεργατική Μάθηση"]
  },
  
  special_needs: {
    suggested: "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία",
    rationale: "Οι μαθητές με ειδικές ανάγκες επωφελούνται σημαντικά από βοηθητικές τεχνολογίες, εξατομικευμένες προσαρμογές και ευέλικτες ψηφιακές υποστηρίξεις.",
    alternatives: ["Διαφοροποιημένη Διδασκαλία", "Τεχνολογικά Ενισχυμένη Αξιολόγηση", "Άμεση Διδασκαλία"]
  },
  
  revision: {
    suggested: "Προσαρμοστική Μάθηση με ψηφιακά εργαλεία",
    rationale: "Η αποτελεσματική επανάληψη απαιτεί διαστηματική επανάληψη, προσαρμοστική ερώτηση και εξατομικευμένο χρονοδιάγραμμα επανεξέτασης - βελτιστοποιημένα από αλγοριθμικά συστήματα.",
    alternatives: ["Τεχνολογικά Ενισχυμένη Αξιολόγηση", "Άμεση Διδασκαλία", "Προσεγγίσεις Εστιασμένες στην Αξιολόγηση"]
  }
};

// Function to show methodology suggestion based on template
function showMethodologySuggestion(templateId) {
  const suggestionDiv = document.getElementById('methodology_suggestion');
  const contentDiv = document.getElementById('suggestion_content');
  const alternativesDiv = document.getElementById('alternative_options');
  const methodologySelect = document.getElementById('methodology');
  
  if (templateId && methodologyResearch[templateId]) {
    const research = methodologyResearch[templateId];
    
    // Auto-select the suggested methodology
    methodologySelect.value = research.suggested;
    
    // Show the suggestion content - ΕΛΛΗΝΙΚΑ (χωρίς citation)
    contentDiv.innerHTML = `<strong>${research.suggested}</strong> συνιστάται. ${research.rationale}`;
    
    // Create alternative option buttons
    alternativesDiv.innerHTML = '';
    research.alternatives.forEach(alt => {
      const button = document.createElement('button');
      button.type = 'button';
      button.className = 'text-xs bg-blue-100 hover:bg-blue-200 text-blue-800 px-2 py-1 rounded transition-colors';
      button.textContent = alt;
      button.onclick = () => {
        methodologySelect.value = alt;
        suggestionDiv.classList.add('hidden');
        updateTheoryRecommendation(); // Update theory suggestion
      };
      alternativesDiv.appendChild(button);
    });
    
    suggestionDiv.classList.remove('hidden');
  } else {
    suggestionDiv.classList.add('hidden');
  }
}

// Update the existing template change listener
document.getElementById('template').addEventListener('change', function() {
  const selectedTemplate = this.value;
  
  if (selectedTemplate && templates[selectedTemplate]) {
    const template = templates[selectedTemplate];
    
    // Fill form fields (keeping existing logic)
    document.getElementById('role').value = template.role;
    document.getElementById('task').value = template.task;
    document.getElementById('context').value = template.context;
    document.getElementById('tone').value = template.tone;
    document.getElementById('include').value = template.include;
    document.getElementById('exclude').value = template.exclude;
    
    // Show methodology suggestion (NEW)
    showMethodologySuggestion(selectedTemplate);
    
    // Visual feedback
    this.classList.add('bg-green-50', 'border-green-300');
    setTimeout(() => {
      this.classList.remove('bg-green-50', 'border-green-300');
    }, 2000);
  } else {
    // Clear form if "Create from scratch" is selected
    document.getElementById('role').value = '';
    document.getElementById('task').value = '';
    document.getElementById('context').value = '';
    document.getElementById('methodology').value = '';
    document.getElementById('tone').value = '';
    document.getElementById('include').value = '';
    document.getElementById('exclude').value = '';
    
    // Hide suggestion
    document.getElementById('methodology_suggestion').classList.add('hidden');
  }
});

// Also trigger theory recommendation when methodology changes manually
document.getElementById('methodology').addEventListener('change', function() {
  // Hide suggestion when user manually changes methodology
  if (this.value !== '') {
    document.getElementById('methodology_suggestion').classList.add('hidden');
  }
  updateTheoryRecommendation(); // Update theory suggestion
});

function goToStep2() {
  // Validate: at least one interest selected
  const selectedInterests = document.querySelectorAll('input[name="training_interests"]:checked');
  
  if (selectedInterests.length === 0) {
    alert('Please select at least one area of interest.');
    return;
  }
  
  // Update progress indicators
  document.getElementById('step1Indicator').classList.remove('bg-blue-600', 'text-white');
  document.getElementById('step1Indicator').classList.add('bg-green-500', 'text-white');
  document.getElementById('progressBar').classList.remove('bg-gray-200');
  document.getElementById('progressBar').classList.add('bg-blue-600');
  document.getElementById('step2Indicator').classList.remove('bg-gray-200', 'text-gray-500');
  document.getElementById('step2Indicator').classList.add('bg-blue-600', 'text-white');
  
  // Hide step 1, show step 2
  document.getElementById('step1Content').classList.add('hidden');
  document.getElementById('step2Content').classList.remove('hidden');
  
  // Populate selected interests in step 2
  populateSelectedInterests();
}

function goToStep1() {
  // Reset progress indicators
  document.getElementById('step1Indicator').classList.remove('bg-green-500');
  document.getElementById('step1Indicator').classList.add('bg-blue-600', 'text-white');
  document.getElementById('progressBar').classList.remove('bg-blue-600');
  document.getElementById('progressBar').classList.add('bg-gray-200');
  document.getElementById('step2Indicator').classList.remove('bg-blue-600', 'text-white');
  document.getElementById('step2Indicator').classList.add('bg-gray-200', 'text-gray-500');
  
  // Hide step 2, show step 1
  document.getElementById('step2Content').classList.add('hidden');
  document.getElementById('step1Content').classList.remove('hidden');
}

function populateSelectedInterests() {
  const selectedInterests = document.querySelectorAll('input[name="training_interests"]:checked');
  const listContainer = document.getElementById('selectedInterestsList');
  
  listContainer.innerHTML = '';
  
  selectedInterests.forEach((checkbox, index) => {
    const label = checkbox.closest('label').textContent.trim();
    const value = checkbox.value;
    
    const interestDiv = document.createElement('div');
    interestDiv.className = 'flex items-center justify-between p-2 bg-blue-50 rounded-lg border border-blue-200';
    interestDiv.innerHTML = `
      <span class="text-sm font-medium text-blue-800">${label}</span>
      <select class="priority-dropdown-step2 text-xs border border-blue-300 rounded px-2 py-1" data-interest="${value}">
        <option value="">Priority</option>
        <option value="1">1st</option>
        <option value="2">2nd</option>
        <option value="3">3rd</option>
      </select>
    `;
    
    listContainer.appendChild(interestDiv);
  });
  
  // Add event listeners to new dropdowns
  setupStep2PriorityListeners();
}

function setupStep2PriorityListeners() {
  const priorityDropdowns = document.querySelectorAll('.priority-dropdown-step2');
  const priorityCount = document.getElementById('priorityCount');
  
  priorityDropdowns.forEach(dropdown => {
    dropdown.addEventListener('change', function() {
      if (this.value) {
        // Clear any other dropdown with the same priority
        priorityDropdowns.forEach(otherDropdown => {
          if (otherDropdown !== this && otherDropdown.value === this.value) {
            otherDropdown.value = '';
          }
        });
      }
      
      // Update priority count
      const selectedPriorities = Array.from(priorityDropdowns)
        .filter(dropdown => dropdown.value).length;
      
      priorityCount.textContent = selectedPriorities;
      
      const priorityMessage = document.getElementById('priorityMessage');
      if (selectedPriorities > 3) {
        priorityMessage.classList.add('text-red-600');
        priorityMessage.classList.remove('text-gray-600', 'text-green-600');
      } else if (selectedPriorities === 3) {
        priorityMessage.classList.add('text-green-600');
        priorityMessage.classList.remove('text-gray-600', 'text-red-600');
      } else {
        priorityMessage.classList.add('text-gray-600');
        priorityMessage.classList.remove('text-red-600', 'text-green-600');
      }
    });
  });
}
</script>

<!-- Survey System Control -->
<script>
    const SURVEYS_ENABLED = {{ settings.ENABLE_SURVEYS|lower }};
    console.log('SURVEYS_ENABLED:', SURVEYS_ENABLED);
</script>

<script src="{% static 'generator/onboarding.js' %}"></script>
{% include 'generator/modals/training_needs_modal.html' %}
</body>

</html>